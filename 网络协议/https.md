## HTTPS (保证密文 防止篡改)

HTTP采用明文传输，中间人可以获取到明文数据（从而实现对数据的篡改）。这时候HTTPS 就灯厂了！
HTTPS是什么？ HTTPS = HTTP + SSL/TLS，SSL 安全套接层（Secure Sockets Layer) 发展到 V3版本的时候改名为 TLS 传输层安全（Transport Layer Security），相当于在HTTP和TCP中间加了个门卫，主要的目的就是提供数据的完整性和保密性。


### 一.数据完整性

https 做了三件事
* 加密：对传输的数据进行加密。
* 数据一致性：保证传输过程中数据不会被篡改
* 身份认证：确定对方的真实身份。

1. 摘要算法
我们可以给内容增加一个摘要，在传输到服务端后再把内容做一次再要，看一下两次摘要后的结果是否一致
（可以根据摘要来辨别数据有没有被篡改）因为篡改的数据和篡改前的摘要肯定不同

2. 对称加密(发送方和接收方都有一把公钥)
> AES(Advanced Encryption Standard 高级加密标准) ChaCha20 为最常见的对称加密算法。

缺点是：同一个接收方多次传输容易被破解。

3. 非对称加密（发送方和接收方都有一把钥匙 发送方会拿到公钥 接收方会拿到私钥）

- 私钥加密公钥解密
- 公钥加密私钥解密 

只能解决一半问题...,只能一方加密通信（可以一人两套）

我们可以靠两套钥匙实现通信，但是问题是性能不好，效率不高，数据越大解密越复杂。

4. 混合加密
对称 + 非对称
* 通过非对称加密解决秘钥传输问题，数据传输利用对称加密问题（公私钥 + 随机数）
（最终用于通讯的秘钥还是客户端生成的）

还是有问题：（中间人攻击可以伪造公钥，你不知道这个公钥是谁发给你的，两头骗了）

5. 数字证书和CA

> 因为谁都可以发布公钥，所以我们需要验证对方身份。防止中间人攻击。

  1. 当客户端访问服务器的时候，服务器会生成自己的私钥和公钥 -> 将公钥传递给CA进行认证（CA机构也有自己的公钥私钥，它会把内容进行一个签名（直接把证书用私钥签名内容太多，那么我们把证书进行摘要（hash），将摘要的结果用私钥加密）; 这一步很大程度都是在服务端和CA机构完成

  2. 客户端要拿到服务器的公钥。客户端会在操作系统中放入根证书，所以收到证书后可以进行验证签名（用内置的CA公钥进行解密，可以解密出摘要）将传递的明文再次摘要和我解密出来的摘要进行匹配，如果一直那么这个公钥就是合法的

  上面两步核心目的都是为了服务器公钥被篡改

  3. 后面就创建会话秘钥进行通信了 
  
  
公钥类型：RSA(1024Bits) RSA(2048Bits) ECDHE....

> 客户端会判断有效期、颁发者、证书是否被修改及证书是否被吊销。每份签发证书都可以根据验证链查找到对应的根证书，操作系统、浏览器会在本地存储权威机构的根证书，利用本地根证书可以对对应机构签发根证书完成来源验证。


- CA认证之后...

> 淘宝没有使用RSA 用的DHCHE算法， cipher suit: TLS(协议)_ECDHE(秘钥交换协议)_RSA(签名算法)_WITH_AES_256_CBC(对称加密算法)_SHA(消息认证码)

下面是DHCHE 的过程
- 客户端给服务端传递了一个随机数
- 服务端也给客户端传递了一个随机数
- 服务端给客户端一个serverParmas DH 参数
- 客户端给服务端一个clientParams DH 参数

服务端会话密钥 = 随机数C + 随机数S + serverParams + clientParams
客户端会话密钥 = 随机数C + 随机数S + serverParams + clientParams

搞这么多这么麻烦为啥？

DH(Diffie-Hellman)参数是明文的，中间人能拿到，但是DH算法中生成的中间值无法被拿到
[DH的过程](./DH_算法过程.png)